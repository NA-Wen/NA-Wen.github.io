---
title: why decoder only in LLM?
date: 2023-09-05 18:47:20
index_img: /cover/3.jpg
author : NA-Wen
category: NLP
tags: [NLP,decoder-only,architecture]
catagories: NLP
---
# why decoder-only in LLM ?
è‡³ä»Šï¼Œ Decoder-onlyçš„æ¶æ„åœ¨NLU & NLGä»»åŠ¡ä¸­å æ®ç€è¶Šæ¥è¶Šé‡è¦çš„åœ°ä½ã€‚ç›¸è¾ƒäºEDï¼ŒLMçš„ä¼˜åŠ¿åœ¨äºä½•å¤„ï¼Ÿ
<!--more-->
# Intro

æˆ‘ä»¬å‘ç°ï¼Œåœ¨2022å¹´OpenAI æ¨å‡ºChatGPTä¹‹åï¼Œä¸€ç›´åˆ°2023å¹´è‡³ä»Šï¼Œ Decoder-onlyçš„æ¶æ„åœ¨NLU & NLGä»»åŠ¡ä¸­å æ®ç€è¶Šæ¥è¶Šé‡è¦çš„åœ°ä½ã€‚ç›¸å…³çš„å·¥ä½œæ•°é‡ä¹Ÿé€æ¸è¶…è¿‡Encoder-only å’ŒEncoder-Decoder æ¶æ„çš„ç›¸å…³å·¥ä½œã€‚

![](/img1/Untitled.png)

ä¹‹å‰googleåœ¨T5è¿™ç¯‡å·¥ä½œä¸­ï¼Œè¯¦ç»†å¯¹æ¯”äº†ä¸åŒçš„æ¨¡å‹æ¶æ„ï¼ˆencoder-decoder, decoder/language model , prefix LMï¼‰å¹¶åšäº†å¯¹æ¯”å®éªŒï¼Œç»“æœå¦‚ä¸‹ã€‚

![](/img1/Untitled%201.png)
å¯ä»¥çœ‹åˆ°ï¼Œä¸å…±äº«å‚æ•°çš„encoder-decoderè¡¨ç°ä¼˜äºå…¶ä»–çš„æ¶æ„ã€‚å·¥ä½œä¸­ç§°ï¼Œè™½ç„¶ä¸å…±äº«å‚æ•°çš„encoder-decoderæ¶æ„å‚æ•°é‡æ˜¯ 2P ï¼Œä½†æ˜¯å…¶æ¨ç†æ—¶é—´å’Œå‚æ•°é‡ä¸º P çš„decoder-only æ¶æ„æ˜¯ç›¸è¿‘çš„ã€‚ä¸”ä¸å…±äº«å‚æ•°çš„Enc-decè¡¨ç°ä¸Šè¦ç•¥å¥½äºå…±äº«å‚æ•°çš„Enc-decã€‚

T5çš„å‚æ•°åªåœ¨ç™¾äº¿å·¦å³ï¼Œåœ¨ç›®å‰GPTçš„åƒäº¿å‚æ•°çº§åˆ«ï¼Œdecoder-onlyçš„æ¶æ„ç›¸è¾ƒEnc-decæ›´åŠ å æ®ä¼˜åŠ¿ï¼ˆä¸è¿‡GLM130Bå’ŒUPalm-540Bä¸æ˜¯decoder-onlyï¼‰ã€‚å¯¹äºæ­¤æ¨¡å‹æ¶æ„ä¸Šçš„è¶‹åŠ¿å˜åŒ–ï¼Œè‹ç¥ç»™å‡ºçš„å›ç­”æ˜¯ï¼š

> è¾“å…¥éƒ¨åˆ†çš„æ³¨æ„åŠ›æ”¹ä¸ºåŒå‘ä¸ä¼šå¸¦æ¥æ”¶ç›Šï¼ŒEncoder-Decoderæ¶æ„çš„ä¼˜åŠ¿å¾ˆå¯èƒ½åªæ˜¯æºäºå‚æ•°ç¿»å€ã€‚
> 

ä¹Ÿæœ‰è¯´æ³•ç§°ï¼Œzero-shotçš„æƒ…å†µä¸‹ï¼Œdecoder-onlyè¡¨ç°æœ€å¥½ï¼ˆå¯¹äºLLM æ¥è¯´ï¼ŒæŠ›å¼ƒfine-tuningèµ°å‘zero-shotæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªfeature ğŸ¥°ï¼‰ã€‚

è¿˜æœ‰è¯´æ³•ç§°ï¼Œå› ä¸ºå¯¹äºdecoder-onlyçš„scaling lawè¢«éªŒè¯ï¼Œå› æ­¤OpenAIæ•¢äºç›´æ¥scale upã€‚è€Œå…¶ä»–çš„æ¨¡å‹æ¶æ„ä¸Šå¹¶æ²¡æœ‰ç±»ä¼¼çš„éªŒè¯è¿‡ç¨‹ã€‚æ‰€ä»¥ç°åœ¨scale upåï¼Œdecoder-onlyçš„æ¶æ„outperformäº†ã€‚

å‰ä¸¤ç§è¯´æ³•ï¼Œåˆ†åˆ«ä»ç†è®ºè¯æ˜å’Œå®éªŒéªŒè¯çš„ä¸åŒè§’åº¦å‡ºå‘ã€‚ç¬”è€…æŸ¥è¯¢äº†ç›¸å…³æ–‡çŒ®ï¼Œè®°å½•äº†ç®€è¦çš„ç¬”è®°å’Œä¸ªäººçš„ä¸€äº›æƒ³æ³•ã€‚

## ä½ç§©é—®é¢˜

> Bhojanapalli, S., Yun, C., Rawat, A.S., Reddi, S. and Kumar, S., 2020, November. Low-rank bottleneck in multi-head attention models. InÂ *International conference on machine learning*Â (pp. 864-873). PMLR.
> 

è¯æ˜äº†attentionä¼šå‡ºç°å› ä¸ºä½ç§©è€Œè¡¨è¾¾èƒ½åŠ›ä¸‹é™çš„åŸå› ï¼Œä¸ºä¹‹åçš„æ€è€ƒæä¾›äº†åŸºç¡€ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬è§„å®šè®°å·å¦‚ä¸‹ï¼š

$$
W_k \in \R^{d_k \times d },W_q \in \R^{d_q \times d },W_v \in \R^{d_v \times d }\\X\in \R^{d\times n}
$$

Xæ˜¯è¾“å…¥çŸ©é˜µï¼ŒWæ˜¯ç”Ÿæˆqueryï¼Œkeyï¼Œvalueçš„çŸ©é˜µã€‚nä»£è¡¨tokenæ•°ç›®ï¼Œdä»£è¡¨tokenç»´åº¦ã€‚

$$
Attention(X)=W_vX\;softmax(\frac{(W_kX)^T(W_qX)}{\sqrt{d_k}})\in \R ^{d_v\times n}\\P=softmax(\frac{(W_kX)^T(W_qX)}{\sqrt{d_k}})\in \R ^{n\times n}
$$

åœ¨ç»è¿‡attentionå±‚ä¹‹åï¼Œè¿˜æœ‰ä¸€ä¸ªå¸¦æ®‹å·®çš„å…¨è¿æ¥å±‚+LN

$$
LN(X+W_o\:Attention(X))
$$

Xå¯èƒ½æ˜¯ä»»ä½•çŸ©é˜µï¼ŒPå¯èƒ½æ˜¯ä»»ä½•çŸ©é˜µã€‚æˆ‘ä»¬å¸Œæœ›çŸ¥é“é€šè¿‡attentionçš„æ“ä½œï¼Œæ˜¯å¦å¯ä»¥è¡¨è¾¾å‡ºæ‰€æœ‰åˆç†çš„Pï¼ˆåªéœ€è¦åˆ—å½’ä¸€ä¸”ä¸ºæ­£ï¼‰ã€‚

è½¬æ¢ä¸ºè¯æ˜ï¼š

$$
\forall X ,\forall P ; \exist\; W_k,W_q \\s.t. \;\;P=softmax(\frac{(W_kX)^T(W_qX)}{\sqrt{d_k}})
$$

å‡å®š$d_k=d_q=d$ , æˆ‘ä»¬å¯ä»¥è¯æ˜

$$
case \;1:\;when \;d\geq n ,always \;\exist W_k,W_q,s.t.......\\case \;2:\;when \;d< n ,not\; \exist W_k,W_q,s.t.......
$$

åœ¨å¤šå¤´æ³¨æ„åŠ›çš„æƒ…å†µä¸‹ï¼Œå¸¸è§„æ“ä½œä¸­ï¼Œæˆ‘ä»¬ä¼šå‡å°‘$W_q,W_k,W_v$çš„ç»´åº¦æ¥ä½¿å¾—æ‹¼æ¥åçš„ç»“æœå’Œå•å¤´æ³¨æ„åŠ›å¾—åˆ°çš„ç»“æœçš„ç»´åº¦ç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š

$$
Head(X)\in \R ^{\frac{d}{h}\times n}\\Multihead(X)\in R^{d\times n}
$$

æ­¤å¤„$h$æ˜¯å¤´æ•°ï¼ˆhead sizeï¼‰ã€‚

æ˜¾ç„¶çš„ï¼Œä»ä¸Šè¿°ç»“è®ºçš„è§’åº¦æ¥è¯´ï¼Œéšç€head sizeçš„å˜å¤§ï¼Œattentionçš„è¡¨è¾¾èƒ½åŠ›ä¼šç›¸åº”çš„æœ‰ä¸‹é™ã€‚è¿™ç¯‡å·¥ä½œä¸­çš„å®éªŒç»“æœä¹Ÿè¯´æ˜äº†è¿™ä¸€ç‚¹(fig1 (a))ã€‚

![](/img1/Untitled%202.png)

ä½†æ˜¯multiheadçš„æå‡ºå®é™…ä¸Šæ˜¯ä¸ºäº†æå‡attentionçš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä¸€å‘³çš„å‰Šå‡head sizeã€‚ä»å¦ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œé€šè¿‡æå‡embedding çš„ç»´åº¦$d$æˆ–è®¸å¯ä»¥é¿å…è¿™æ ·çš„é—®é¢˜ã€‚

ä½†æ˜¯å®é™…ä¸Šï¼Œå› ä¸ºtokensæ•°ç›®å¾ˆå¤§ï¼Œæå‡embeddingç»´åº¦ä¼šå¸¦æ¥å¾ˆå¤§çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ï¼Œåˆå› ä¸ºåœ¨å¯¹ä¸‹æ¸¸ä»»åŠ¡åšå¾®è°ƒæ—¶ä¹Ÿæ˜¯ä½¿ç”¨è®­ç»ƒå¥½çš„embeddingçŸ©é˜µï¼Œå°†æ›´å¤§çš„å¼€é”€ä¹Ÿå¸¦ç»™äº†å¯¹æ‰€æœ‰ä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒã€‚

è€ƒè™‘åˆ°è¿™äº›å› ç´ ï¼Œè¿™ç¯‡å·¥ä½œæå‡ºäº† fixed multi-head attention ,å³é€šè¿‡è§£é™¤head sizeå’Œ$d_q,d_k,d_V$çš„å…³ç³»ï¼Œæ¥å®ç°åœ¨ä¿è¯head sizeçš„åŒæ—¶ï¼Œå°½é‡é¿å…é™ç§©çš„é—®é¢˜ã€‚å³å°±æ˜¯ï¼š

$$
d_q=d_k=d_v=d_p\\FixedMultihead(X)\in \R ^{d_p h\times n}
$$

### seminar conclusion

decoder-only ä¸­attentionçŸ©é˜µæœ‰maskæ“ä½œï¼Œæˆä¸ºä¸‹ä¸‰è§’çŸ©é˜µã€‚å› ä¸ºå…¶è¡Œåˆ—å¼å€¼éé›¶ï¼Œæ‰€ä»¥æ˜¯æ»¡ç§©çš„ã€‚ä»æ­¤æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ–­è¨€æ»¡ç§©çš„maskçŸ©é˜µè¡¨è¾¾èƒ½åŠ›æ›´å¼ºï¼Œä½¿å¾—decoder-onlyçš„æ¶æ„å¥½äºencoder-decoderï¼Ÿ

ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå³ä½¿ä¿è¯attentionæ»¡ç§©ï¼Œä¹Ÿä¸ä¸€å®šèƒ½åšåˆ°çŸ©é˜µPçš„å®Œå…¨è¡¨è¾¾ã€‚

åŒæ—¶ï¼Œå› ä¸ºdecoder-onlyåªæ˜¯å•å‘æ³¨æ„åŠ›ï¼Œè€Œencoder-decoderåœ¨encoderéƒ¨åˆ†æ˜¯åŒå‘æ³¨æ„åŠ›ã€‚å³ä½¿å› ä¸ºæ»¡ç§©å•å‘æ³¨æ„åŠ›ä¿¡æ¯å¾—åˆ°äº†å……åˆ†çš„è¡¨è¾¾ï¼Œä¹Ÿå¹¶ä¸ä»£è¡¨ç€æ¯”éå……åˆ†è¡¨è¾¾çš„åŒå‘æ³¨æ„åŠ›ä¿¡æ¯æ›´åŠ å…¨é¢ã€‚

ç»¼åˆè€ƒè™‘ï¼Œä»ç†è®ºçš„è§’åº¦å¹¶ä¸èƒ½å¾—å‡ºæ˜ç¡®çš„ç»“è®ºã€‚

### zero-shot for decoder-only

> Wang, T., Roberts, A., Hesslow, D., Le Scao, T., Chung, H.W., Beltagy, I., Launay, J. and Raffel, C., 2022, June. What language model architecture and pretraining objective works best for zero-shot generalization?. InÂ *International Conference on Machine Learning*Â (pp. 22964-22984). PMLR.
> 

![](/img1/Untitled%203.png)

é¦–å…ˆï¼Œæ¨¡å‹æœ‰ç€ä¸åŒçš„æ¶æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![](/img1/Untitled%204.png)

decoderï¼šå…¨éƒ¨å•å‘æ³¨æ„åŠ›

non-casual decoder: è¾“å…¥éƒ¨åˆ†æ˜¯åŒå‘ï¼Œè¾“å‡ºéƒ¨åˆ†æ˜¯å•å‘ï¼›ä½†æ˜¯è¾“å‡ºå’Œè¾“å…¥éƒ¨åˆ†æ˜¯å…±äº«å‚æ•°çš„ï¼ˆä¹Ÿå«åšprefix LMï¼‰

encoder-decoderï¼šè¾“å…¥éƒ¨åˆ†æ˜¯åŒå‘ï¼Œè¾“å‡ºéƒ¨åˆ†æ˜¯å•å‘ï¼›è¾“å…¥å’Œè¾“å‡ºéƒ¨åˆ†ä¸å…±äº«å‚æ•°

åŒæ—¶ï¼Œé¢„è®­ç»ƒé˜¶æ®µæœ‰ç€ä¸åŒçš„ä»»åŠ¡ï¼š

![](/img1/Untitled%205.png)

è¿™å‡ ç§LMé¢„è®­ç»ƒç›®æ ‡æ›´å¤šçš„éƒ½ç”¨åœ¨ç”Ÿæˆä»»åŠ¡ä¸Šï¼Œè€Œdenoisingä½œä¸ºé¢„è®­ç»ƒç›®æ ‡æ›´å¤šç”¨äºç¼–ç ã€‚

åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šè¿›è¡Œfine-tuningè¿™ä¸€å˜é‡ï¼Œå¯¹äºå„ç§å˜é‡è¿›è¡Œè‡ªç”±ç»„åˆå¹¶å®éªŒï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š

![](/img1/Untitled%206.png)
![](/img1/Untitled%207.png)
![](/img1/Untitled%208.png)

ä»Finding 1 çš„è§’åº¦ï¼Œå¯ä»¥çœ‹å‡ºï¼Œdecoder-onlyæ¶æ„åœ¨åšFLMæ—¶ï¼Œä¸åšfine-tuneï¼Œzero-shotä¸‹è¡¨ç°æœ€å¥½ã€‚
